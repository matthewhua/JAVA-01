## 高并发秒杀系统架构的设计

### 1 . 秒杀系统框架设计需要注意的关键点

	#### 	1.1秒杀系统主要解决两个问题

		>并发读: 并发读的核心优化理念是尽量减少用户到服务端来“读”数据，或者让他们读更少的数据
		>
		>并发写: 并发写的处理原则也一样，它要求我们在数据库层面独立出来一个库，做特殊的处理。

另外，我们还要针对秒杀系统做一些保护，针对意料之外的情况设计兜底方案，以防止最坏的情况发生。

**所以, 秒杀的整体架构可以概括为" 稳, 准, 快" 几个关键字**



>所谓“稳”，就是整个系统架构要满足高可用，流量符合预期时肯定要稳定，就是超出预期时也同样不能掉链子，你要保证秒杀活动顺利完成，即秒杀商品顺利地卖出去，这个是最基本的前提。
>
>然后就是“准”，就是秒杀 10 台 iPhone，那就只能成交 10 台，多一台少一台都不行。一旦库存不对，那平台就要承担损失，所以“准”就是要求保证数据的一致性。
>
>最后再看“快”，“快”其实很好理解，它就是说系统的性能要足够高，否则你怎么支撑这么大的流量呢？不光是服务端要做极致的性能优化，而且在整个请求链路上都要做协同的优化，每个地方快一点，整个系统就完美了。

- **高性能。** 秒杀涉及大量的并发读和并发写，因此支持高并发访问这点非常关键。本专栏将从设计数据的动静分离方案、热点的发现与隔离、请求的削峰与分层过滤、服务端的极致优化

- **一致性。** 秒杀中商品减库存的实现方式同样关键。可想而知，有限数量的商品在同一时刻被很多倍的请求同时来减库存，减库存又分为“拍下减库存”“付款减库存”以及预扣等几种，在大并发更新的过程中都要保证数据的准确性，其难度可想而知。

- **高可用。** 设计一个 PlanB 来兜底，以便在最坏情况发生时仍然能够从容应对。

### 2. 秒杀系统应该注意的架构原则

​	**秒杀系统本质上就是一个满足大并发、高性能和高可用的分布式系统**。

​	这里有架构原则 ：“**四要 一不要**”

1. **数据要尽量少**  所谓“数据要尽量少”，首先是指用户请求的数据能少就少。请求的数据包括上传给系统的数据和系统返回给用户的数据（通常就是网页）。数据要尽量少”还要求系统依赖的数据能少就少，包括系统完成某些业务逻辑需要读取和保存的数据，这些数据一般是和后台服务以及数据库打交道的。调用其他服务会涉及数据的序列化和反序列化，而这也是 CPU 的一大杀手，同样也会增加延时。

2. **请求数要尽量少** 用户请求的页面返回后，浏览器渲染这个页面还要包含其他的额外请求，比如说，这个页面依赖的 CSS/JavaScript、图片，以及 Ajax 请求等等都定义为“额外请求”，这些额外请求应该尽量少。因为浏览器每发出一个请求都多少会有一些消耗，例如建立连接要做三次握手，有的时候有页面依赖或者连接数限制，一些请求（例如 JavaScript）还需要串行加载等。另外，如果不同请求的域名不一样的话，还涉及这些域名的 DNS 解析，可能会耗时更久。所以你要记住的是，减少请求数可以显著减少以上这些因素导致的资源消耗。  **减少请求数最常用的一个实践就是合并 CSS 和 JavaScript 文件，把多个 JavaScript 文件合并成一个文件，**

3. **路径要尽量短**   所谓“路径”，就是用户发出请求到返回数据这个过程中，需求经过的中间的节点数。

4. **依赖要尽量少 ** 所谓依赖，指的是要完成一次用户请求必须依赖的系统或者服务，这里的依赖指的是强依赖。 要减少依赖，我们可以给系统进行分级，比如 0 级系统、1 级系统、2 级系统、3 级系统，0 级系统如果是最重要的系统，那么 0 级系统强依赖的系统也同样是最重要的系统，以此类推。

5. **不要有单点** 系统中的单点可以说是系统架构上的一个大忌，因为单点意味着没有备份，风险不可控，我们设计分布式系统最重要的原则就是“消除单点”。

   >单点有两层含义
   >一是本身的系统是单点系统，比如你说的登录系统，所以其他系统需要验证登录状态时都需要调用他，那他就是一个单点，怎么解决？解决的办法就是尽量让这个系统简单，减少更改保持稳定。
   >另外一种是状态单点或者叫数据单点，也就是状态一旦丢失比较难恢复，这个就比较麻烦，比如保存登录状态的session保存在一台机器内存中，一旦这台机器挂掉，状态丢失就比较难恢复，这个单点就比较严重

   #### 2.1 秒杀系统





